<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
                      <html>
                    <head>
                    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
                    <title>ProVerif: process 1</title>
                    <link rel="stylesheet" href="cssproverif.css">
                                                                           </head>
                                                                         <body>
                                                                         <H1>Process 1 (<A HREF="process_0.html" TARGET="process">process 0</A>, with let moved downwards)</H1>
<a name=occ1 class="occ">{1}</a> <span class="keyword">!</span><br>
<a name=occ2 class="occ">{2}</a> <span class="keyword">new</span> <span class="name">vmsecretkey</span>: <span class="type">secretKey</span>;<br>
<a name=occ3 class="occ">{3}</a> <span class="keyword">let</span> <span class="var">vmpublickey</span>: <span class="type">publicKey</span> = <span class="fun">signedPublicKey</span>(<span class="name">vmsecretkey</span>) <span class="keyword">in</span><br>
<a name=occ4 class="occ">{4}</a> <span class="keyword">out</span>(<span class="name">ch</span>, <span class="var">vmpublickey</span>);<br>
<a name=occ5 class="occ">{5}</a> <span class="keyword">new</span> <span class="name">trgsecretkey</span>: <span class="type">secretKey</span>;<br>
<a name=occ6 class="occ">{6}</a> <span class="keyword">let</span> <span class="var">trgpublickey</span>: <span class="type">publicKey</span> = <span class="fun">signedPublicKey</span>(<span class="name">trgsecretkey</span>) <span class="keyword">in</span><br>
<a name=occ7 class="occ">{7}</a> <span class="keyword">out</span>(<span class="name">ch</span>, <span class="var">trgpublickey</span>);<br>
<a name=occ8 class="occ">{8}</a> <span class="keyword">new</span> <span class="name">bbsecretkey</span>: <span class="type">secretKey</span>;<br>
<a name=occ9 class="occ">{9}</a> <span class="keyword">let</span> <span class="var">bbpublickey</span>: <span class="type">publicKey</span> = <span class="fun">signedPublicKey</span>(<span class="name">bbsecretkey</span>) <span class="keyword">in</span><br>
<a name=occ10 class="occ">{10}</a> <span class="keyword">out</span>(<span class="name">ch</span>, <span class="var">bbpublickey</span>);<br>
<a name=occ11 class="occ">{11}</a> <span class="keyword">new</span> <span class="name">vsecretkey</span>: <span class="type">secretKey</span>;<br>
<a name=occ12 class="occ">{12}</a> <span class="keyword">let</span> <span class="var">vpublickey</span>: <span class="type">publicKey</span> = <span class="fun">signedPublicKey</span>(<span class="name">vsecretkey</span>) <span class="keyword">in</span><br>
<a name=occ13 class="occ">{13}</a> <span class="keyword">out</span>(<span class="name">ch</span>, <span class="var">vpublickey</span>);<br>
<a name=occ14 class="occ">{14}</a> <span class="keyword">new</span> <span class="name">channelvoterandva</span>: <span class="type">channel</span>;<br>
<a name=occ15 class="occ">{15}</a> <span class="keyword">new</span> <span class="name">channelvoterandtrg</span>: <span class="type">channel</span>;<br>
<a name=occ16 class="occ">{16}</a> <span class="keyword">new</span> <span class="name">channeltrgandmachine</span>: <span class="type">channel</span>;<br>
<a name=occ17 class="occ">{17}</a> <span class="keyword">new</span> <span class="name">channelvaprep</span>: <span class="type">channel</span>;<br>
<a name=occ18 class="occ">{18}</a> <span class="keyword">new</span> <span class="name">channelvareceipts</span>: <span class="type">channel</span>;<br>
<a name=occ19 class="occ">{19}</a> <span class="keyword">new</span> <span class="name">channeltrgandtest</span>: <span class="type">channel</span>;<br>
<a name=occ20 class="occ">{20}</a> <span class="keyword">new</span> <span class="name">channelvoterandtest</span>: <span class="type">channel</span>;<br>
<a name=occ21 class="occ">{21}</a> <span class="keyword">new</span> <span class="name">channelBBandTest</span>: <span class="type">channel</span>;<br>
<a name=occ22 class="occ">{22}</a> <span class="keyword">new</span> <span class="name">channelVAandTest</span>: <span class="type">channel</span>;<br>
<a name=occ23 class="occ">{23}</a> <span class="keyword">!</span><br>
<a name=occ24 class="occ">{24}</a> <span class="keyword">new</span> <span class="name">sessionidv</span>: <span class="type">bitstring</span>;<br>
<a name=occ25 class="occ">{25}</a> <span class="keyword">out</span>(<span class="name">ch</span>, <span class="name">sessionidv</span>);<br>
(<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ33 class="occ">{33}</a> <span class="keyword">new</span> <span class="name">rand1rand1</span>: <span class="type">bitstring</span>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ34 class="occ">{34}</a> <span class="keyword">new</span> <span class="name">rand1Candidate1</span>: <span class="type">bitstring</span>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ35 class="occ">{35}</a> <span class="keyword">new</span> <span class="name">rand2rand2</span>: <span class="type">bitstring</span>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ36 class="occ">{36}</a> <span class="keyword">new</span> <span class="name">rand2Candidate2</span>: <span class="type">bitstring</span>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ37 class="occ">{37}</a> <span class="keyword">new</span> <span class="name">dummyRandomNumber1</span>: <span class="type">bitstring</span>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ38 class="occ">{38}</a> <span class="keyword">new</span> <span class="name">dummyRandomNumber2</span>: <span class="type">bitstring</span>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ42 class="occ">{42}</a> <span class="keyword">let</span> <span class="var">candidateCommit2</span>: <span class="type">commit</span> = <span class="fun">commitValue</span>(<span class="fun">candidate1</span>,<span class="name">rand2Candidate2</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ41 class="occ">{41}</a> <span class="keyword">let</span> <span class="var">candidateCommit1</span>: <span class="type">commit</span> = <span class="fun">commitValue</span>(<span class="fun">candidate0</span>,<span class="name">rand1Candidate1</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ45 class="occ">{45}</a> <span class="keyword">let</span> <span class="var">pz1</span>: <span class="type">bitstring</span> = <span class="fun">pzk1</span>(<span class="fun">candidate0</span>,<span class="fun">candidate1</span>,<span class="name">rand1Candidate1</span>,<span class="name">rand2Candidate2</span>,<span class="var">candidateCommit1</span>,<span class="var">candidateCommit2</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ40 class="occ">{40}</a> <span class="keyword">let</span> <span class="var">randomNumberCommit2</span>: <span class="type">commit</span> = <span class="fun">commitValue</span>(<span class="name">dummyRandomNumber2</span>,<span class="name">rand2rand2</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ44 class="occ">{44}</a> <span class="keyword">let</span> <span class="var">dVotePair2</span>: <span class="type">dvote</span> = <span class="fun">dummyVotePair</span>(<span class="var">randomNumberCommit2</span>,<span class="var">candidateCommit2</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ39 class="occ">{39}</a> <span class="keyword">let</span> <span class="var">randomNumberCommit1</span>: <span class="type">commit</span> = <span class="fun">commitValue</span>(<span class="name">dummyRandomNumber1</span>,<span class="name">rand1rand1</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ43 class="occ">{43}</a> <span class="keyword">let</span> <span class="var">dVotePair1</span>: <span class="type">dvote</span> = <span class="fun">dummyVotePair</span>(<span class="var">randomNumberCommit1</span>,<span class="var">candidateCommit1</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ28 class="occ">{28}</a> <span class="keyword">let</span> <span class="var">channelVAPrep</span>: <span class="type">channel</span> = <span class="name">channelvaprep</span> <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ26 class="occ">{26}</a> <span class="keyword">let</span> <span class="var">sessionidv_1</span>: <span class="type">bitstring</span> = <span class="name">sessionidv</span> <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ46 class="occ">{46}</a> <span class="keyword">out</span>(<span class="var">channelVAPrep</span>, <span class="fun"></span>(<span class="var">dVotePair1</span>,<span class="var">dVotePair2</span>,<span class="var">pz1</span>,<span class="var">sessionidv_1</span>));<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ30 class="occ">{30}</a> <span class="keyword">let</span> <span class="var">channelVoterAndVA</span>: <span class="type">channel</span> = <span class="name">channelvoterandva</span> <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ47 class="occ">{47}</a> <span class="keyword">in</span>(<span class="var">channelVoterAndVA</span>, <span class="var">signedcand</span>: <span class="type">bitstring</span>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ48 class="occ">{48}</a> <span class="keyword">let</span> <span class="fun"></span>(<span class="var">candidateX</span>: <span class="type">bitstring</span>,=<span class="var">sessionidv_1</span>) = <span class="fun">checksign</span>(<span class="var">signedcand</span>,<span class="var">vpublickey</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ49 class="occ">{49}</a> <span class="keyword">if</span> ((<span class="var">candidateX</span> <span class="fun">=</span> <span class="fun">candidate0</span>) <span class="fun">||</span> (<span class="var">candidateX</span> <span class="fun">=</span> <span class="fun">candidate1</span>)) <span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ31 class="occ">{31}</a> <span class="keyword">let</span> <span class="var">channelTRGAndMachine</span>: <span class="type">channel</span> = <span class="name">channeltrgandmachine</span> <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ50 class="occ">{50}</a> <span class="keyword">in</span>(<span class="var">channelTRGAndMachine</span>, <span class="var">randomWithSignature</span>: <span class="type">bitstring</span>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ51 class="occ">{51}</a> <span class="keyword">let</span> <span class="fun"></span>(<span class="var">freshRandomNumber</span>: <span class="type">bitstring</span>,=<span class="var">sessionidv_1</span>) = <span class="fun">checksign</span>(<span class="var">randomWithSignature</span>,<span class="var">trgpublickey</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ52 class="occ">{52}</a> <span class="keyword">out</span>(<span class="var">channelTRGAndMachine</span>, <span class="var">freshRandomNumber</span>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ53 class="occ">{53}</a> <span class="keyword">new</span> <span class="name">barCode</span>: <span class="type">bitstring</span>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ32 class="occ">{32}</a> <span class="keyword">let</span> <span class="var">VMSecretKey</span>: <span class="type">secretKey</span> = <span class="name">vmsecretkey</span> <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ54 class="occ">{54}</a> <span class="keyword">let</span> <span class="var">paper_ballot</span>: <span class="type">bitstring</span> = <span class="fun">sign</span>(<span class="fun"></span>(<span class="var">signedcand</span>,<span class="name">barCode</span>),<span class="var">VMSecretKey</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ29 class="occ">{29}</a> <span class="keyword">let</span> <span class="var">channelVAReceipts</span>: <span class="type">channel</span> = <span class="name">channelvareceipts</span> <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ27 class="occ">{27}</a> <span class="keyword">let</span> <span class="var">channelVAandTest_1</span>: <span class="type">channel</span> = <span class="name">channelVAandTest</span> <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ55 class="occ">{55}</a> <span class="keyword">if</span> (<span class="var">candidateX</span> <span class="fun">=</span> <span class="fun">candidate0</span>) <span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ56 class="occ">{56}</a> <span class="keyword">let</span> <span class="var">receipt</span>: <span class="type">bitstring</span> = <span class="fun">sign</span>(<span class="fun"></span>(<span class="fun">candidate0</span>,<span class="fun">candidate1</span>,<span class="var">freshRandomNumber</span>,<span class="name">dummyRandomNumber2</span>,<span class="name">barCode</span>,<span class="var">sessionidv_1</span>),<span class="var">VMSecretKey</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ57 class="occ">{57}</a> <span class="keyword">out</span>(<span class="var">channelVoterAndVA</span>, <span class="var">receipt</span>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ58 class="occ">{58}</a> <span class="keyword">out</span>(<span class="var">channelVAandTest_1</span>, <span class="fun"></span>(<span class="var">paper_ballot</span>,<span class="var">sessionidv_1</span>));<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ59 class="occ">{59}</a> <span class="keyword">new</span> <span class="name">rr3</span>: <span class="type">bitstring</span>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ60 class="occ">{60}</a> <span class="keyword">new</span> <span class="name">rc3</span>: <span class="type">bitstring</span>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ62 class="occ">{62}</a> <span class="keyword">let</span> <span class="var">cc3</span>: <span class="type">commit</span> = <span class="fun">commitValue</span>(<span class="fun">candidate0</span>,<span class="name">rc3</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ61 class="occ">{61}</a> <span class="keyword">let</span> <span class="var">rnc3</span>: <span class="type">commit</span> = <span class="fun">commitValue</span>(<span class="var">freshRandomNumber</span>,<span class="name">rr3</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ63 class="occ">{63}</a> <span class="keyword">let</span> <span class="var">dVotePair3</span>: <span class="type">dvote</span> = <span class="fun">dummyVotePair</span>(<span class="var">rnc3</span>,<span class="var">cc3</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ64 class="occ">{64}</a> <span class="keyword">out</span>(<span class="var">channelVAReceipts</span>, <span class="fun"></span>(<span class="var">receipt</span>,<span class="var">dVotePair3</span>,<span class="fun">pzk2</span>(<span class="fun">candidate0</span>,<span class="fun">candidate1</span>,<span class="name">dummyRandomNumber2</span>,<span class="var">dVotePair3</span>,<span class="var">dVotePair2</span>,<span class="name">rand2Candidate2</span>,<span class="name">rc3</span>,<span class="name">rand2rand2</span>,<span class="name">rr3</span>),<span class="var">dVotePair1</span>,<span class="var">sessionidv_1</span>))<br>
&nbsp;&nbsp;&nbsp;&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ65 class="occ">{65}</a> <span class="keyword">if</span> (<span class="var">candidateX</span> <span class="fun">=</span> <span class="fun">candidate1</span>) <span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ66 class="occ">{66}</a> <span class="keyword">let</span> <span class="var">receipt_1</span>: <span class="type">bitstring</span> = <span class="fun">sign</span>(<span class="fun"></span>(<span class="fun">candidate0</span>,<span class="fun">candidate1</span>,<span class="name">dummyRandomNumber1</span>,<span class="var">freshRandomNumber</span>,<span class="name">barCode</span>,<span class="var">sessionidv_1</span>),<span class="var">VMSecretKey</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ67 class="occ">{67}</a> <span class="keyword">out</span>(<span class="var">channelVoterAndVA</span>, <span class="var">receipt_1</span>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ68 class="occ">{68}</a> <span class="keyword">out</span>(<span class="var">channelVAandTest_1</span>, <span class="fun"></span>(<span class="var">paper_ballot</span>,<span class="var">sessionidv_1</span>));<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ69 class="occ">{69}</a> <span class="keyword">new</span> <span class="name">rr3_1</span>: <span class="type">bitstring</span>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ70 class="occ">{70}</a> <span class="keyword">new</span> <span class="name">rc3_1</span>: <span class="type">bitstring</span>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ72 class="occ">{72}</a> <span class="keyword">let</span> <span class="var">cc3_1</span>: <span class="type">commit</span> = <span class="fun">commitValue</span>(<span class="fun">candidate1</span>,<span class="name">rc3_1</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ71 class="occ">{71}</a> <span class="keyword">let</span> <span class="var">rnc3_1</span>: <span class="type">commit</span> = <span class="fun">commitValue</span>(<span class="var">freshRandomNumber</span>,<span class="name">rr3_1</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ73 class="occ">{73}</a> <span class="keyword">let</span> <span class="var">dVotePair3_1</span>: <span class="type">dvote</span> = <span class="fun">dummyVotePair</span>(<span class="var">rnc3_1</span>,<span class="var">cc3_1</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ74 class="occ">{74}</a> <span class="keyword">out</span>(<span class="var">channelVAReceipts</span>, <span class="fun"></span>(<span class="var">receipt_1</span>,<span class="var">dVotePair3_1</span>,<span class="fun">pzk2</span>(<span class="fun">candidate0</span>,<span class="fun">candidate1</span>,<span class="name">dummyRandomNumber1</span>,<span class="var">dVotePair3_1</span>,<span class="var">dVotePair1</span>,<span class="name">rand1Candidate1</span>,<span class="name">rc3_1</span>,<span class="name">rand1rand1</span>,<span class="name">rr3_1</span>),<span class="var">dVotePair2</span>,<span class="var">sessionidv_1</span>))<br>
) | (<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ80 class="occ">{80}</a> <span class="keyword">new</span> <span class="name">freshRandomNumber_1</span>: <span class="type">bitstring</span>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ78 class="occ">{78}</a> <span class="keyword">let</span> <span class="var">ch1</span>: <span class="type">channel</span> = <span class="name">channeltrgandmachine</span> <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ76 class="occ">{76}</a> <span class="keyword">let</span> <span class="var">TRGSecretKey</span>: <span class="type">secretKey</span> = <span class="name">trgsecretkey</span> <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ75 class="occ">{75}</a> <span class="keyword">let</span> <span class="var">sessionIdTRG</span>: <span class="type">bitstring</span> = <span class="name">sessionidv</span> <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ81 class="occ">{81}</a> <span class="keyword">out</span>(<span class="var">ch1</span>, <span class="fun">sign</span>(<span class="fun"></span>(<span class="name">freshRandomNumber_1</span>,<span class="var">sessionIdTRG</span>),<span class="var">TRGSecretKey</span>));<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ82 class="occ">{82}</a> <span class="keyword">in</span>(<span class="var">ch1</span>, =<span class="name">freshRandomNumber_1</span>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ77 class="occ">{77}</a> <span class="keyword">let</span> <span class="var">ch0</span>: <span class="type">channel</span> = <span class="name">channelvoterandtrg</span> <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ83 class="occ">{83}</a> <span class="keyword">out</span>(<span class="var">ch0</span>, <span class="fun">sign</span>(<span class="fun"></span>(<span class="name">freshRandomNumber_1</span>,<span class="var">sessionIdTRG</span>),<span class="var">TRGSecretKey</span>));<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ79 class="occ">{79}</a> <span class="keyword">let</span> <span class="var">channelTRGAndTest</span>: <span class="type">channel</span> = <span class="name">channeltrgandtest</span> <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ84 class="occ">{84}</a> <span class="keyword">out</span>(<span class="var">channelTRGAndTest</span>, <span class="fun"></span>(<span class="fun">sign</span>(<span class="fun"></span>(<span class="name">freshRandomNumber_1</span>,<span class="var">sessionIdTRG</span>),<span class="var">TRGSecretKey</span>),<span class="var">sessionIdTRG</span>))<br>
) | (<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ87 class="occ">{87}</a> <span class="keyword">let</span> <span class="var">candidateX_1</span>: <span class="type">bitstring</span> = <span class="fun">candidate0</span> <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ85 class="occ">{85}</a> <span class="keyword">let</span> <span class="var">sessionIDv</span>: <span class="type">bitstring</span> = <span class="name">sessionidv</span> <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ91 class="occ">{91}</a> <span class="keyword">event</span> <span class="fun">VoterChoice</span>(<span class="var">candidateX_1</span>,<span class="var">sessionIDv</span>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ92 class="occ">{92}</a> <span class="keyword">in</span>(<span class="name">ch</span>, <span class="fun"></span>(<span class="var">d1</span>: <span class="type">dvote</span>,<span class="var">d2</span>: <span class="type">dvote</span>,<span class="var">zkp</span>: <span class="type">bitstring</span>,=<span class="var">sessionIDv</span>));<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ93 class="occ">{93}</a> <span class="keyword">if</span> ((<span class="var">candidateX_1</span> <span class="fun">=</span> <span class="fun">candidate0</span>) <span class="fun">||</span> (<span class="var">candidateX_1</span> <span class="fun">=</span> <span class="fun">candidate1</span>)) <span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ89 class="occ">{89}</a> <span class="keyword">let</span> <span class="var">channelVoterAndVA_1</span>: <span class="type">channel</span> = <span class="name">channelvoterandva</span> <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ86 class="occ">{86}</a> <span class="keyword">let</span> <span class="var">vkey</span>: <span class="type">secretKey</span> = <span class="name">vsecretkey</span> <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ94 class="occ">{94}</a> <span class="keyword">out</span>(<span class="var">channelVoterAndVA_1</span>, <span class="fun">sign</span>(<span class="fun"></span>(<span class="var">candidateX_1</span>,<span class="var">sessionIDv</span>),<span class="var">vkey</span>));<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ88 class="occ">{88}</a> <span class="keyword">let</span> <span class="var">channelVoterAndTRG</span>: <span class="type">channel</span> = <span class="name">channelvoterandtrg</span> <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ95 class="occ">{95}</a> <span class="keyword">in</span>(<span class="var">channelVoterAndTRG</span>, <span class="var">randomWithSignature_1</span>: <span class="type">bitstring</span>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ96 class="occ">{96}</a> <span class="keyword">let</span> <span class="fun"></span>(<span class="var">freshRandomNumber_2</span>: <span class="type">bitstring</span>,=<span class="var">sessionIDv</span>) = <span class="fun">checksign</span>(<span class="var">randomWithSignature_1</span>,<span class="var">trgpublickey</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ97 class="occ">{97}</a> <span class="keyword">out</span>(<span class="name">ch</span>, <span class="var">freshRandomNumber_2</span>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ98 class="occ">{98}</a> <span class="keyword">in</span>(<span class="var">channelVoterAndVA_1</span>, <span class="var">receipt_2</span>: <span class="type">bitstring</span>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ99 class="occ">{99}</a> <span class="keyword">let</span> <span class="fun"></span>(<span class="var">ca</span>: <span class="type">bitstring</span>,<span class="var">cb</span>: <span class="type">bitstring</span>,<span class="var">ra</span>: <span class="type">bitstring</span>,<span class="var">rb</span>: <span class="type">bitstring</span>,<span class="var">barcodeR'</span>: <span class="type">bitstring</span>,=<span class="var">sessionIDv</span>) = <span class="fun">checksign</span>(<span class="var">receipt_2</span>,<span class="var">vmpublickey</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ90 class="occ">{90}</a> <span class="keyword">let</span> <span class="var">channelVoterAndTest</span>: <span class="type">channel</span> = <span class="name">channelvoterandtest</span> <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ100 class="occ">{100}</a> <span class="keyword">if</span> (((<span class="var">ra</span> <span class="fun">=</span> <span class="var">freshRandomNumber_2</span>) <span class="fun">&amp;&amp;</span> ((<span class="var">ca</span> <span class="fun">=</span> <span class="fun">candidate0</span>) <span class="fun">&amp;&amp;</span> ((<span class="var">cb</span> <span class="fun">=</span> <span class="fun">candidate1</span>) <span class="fun">&amp;&amp;</span> (<span class="var">candidateX_1</span> <span class="fun">=</span> <span class="fun">candidate0</span>)))) <span class="fun">||</span> ((<span class="var">rb</span> <span class="fun">=</span> <span class="var">freshRandomNumber_2</span>) <span class="fun">&amp;&amp;</span> ((<span class="var">ca</span> <span class="fun">=</span> <span class="fun">candidate0</span>) <span class="fun">&amp;&amp;</span> ((<span class="var">cb</span> <span class="fun">=</span> <span class="fun">candidate1</span>) <span class="fun">&amp;&amp;</span> (<span class="var">candidateX_1</span> <span class="fun">=</span> <span class="fun">candidate1</span>))))) <span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ101 class="occ">{101}</a> <span class="keyword">event</span> <span class="fun">OKv</span>(<span class="var">freshRandomNumber_2</span>,<span class="var">candidateX_1</span>,<span class="var">sessionIDv</span>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ102 class="occ">{102}</a> <span class="keyword">out</span>(<span class="var">channelVoterAndTest</span>, <span class="fun"></span>(<span class="var">candidateX_1</span>,<span class="var">receipt_2</span>,<span class="var">sessionIDv</span>));<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ103 class="occ">{103}</a> <span class="keyword">in</span>(<span class="name">ch</span>, <span class="var">myBBreceipt</span>: <span class="type">bitstring</span>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ104 class="occ">{104}</a> <span class="keyword">let</span> <span class="fun"></span>(<span class="var">receiptBB</span>: <span class="type">bitstring</span>,<span class="var">BBinstance</span>: <span class="type">bitstring</span>,=<span class="var">sessionIDv</span>) = <span class="fun">checksign</span>(<span class="var">myBBreceipt</span>,<span class="var">bbpublickey</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">0</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ105 class="occ">{105}</a> <span class="keyword">event</span> <span class="fun">KOv</span>(<span class="var">freshRandomNumber_2</span>,<span class="var">candidateX_1</span>,<span class="var">sessionIDv</span>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ106 class="occ">{106}</a> <span class="keyword">out</span>(<span class="var">channelVoterAndTest</span>, <span class="fun"></span>(<span class="var">candidateX_1</span>,<span class="var">receipt_2</span>,<span class="var">sessionIDv</span>));<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ107 class="occ">{107}</a> <span class="keyword">in</span>(<span class="name">ch</span>, <span class="var">myBBreceipt_1</span>: <span class="type">bitstring</span>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ108 class="occ">{108}</a> <span class="keyword">let</span> <span class="fun"></span>(<span class="var">receiptBB_1</span>: <span class="type">bitstring</span>,<span class="var">BBinstance_1</span>: <span class="type">bitstring</span>,=<span class="var">sessionIDv</span>) = <span class="fun">checksign</span>(<span class="var">myBBreceipt_1</span>,<span class="var">bbpublickey</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">0</span><br>
) | (<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ110 class="occ">{110}</a> <span class="keyword">let</span> <span class="var">chVAPrep</span>: <span class="type">channel</span> = <span class="name">channelvaprep</span> <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ109 class="occ">{109}</a> <span class="keyword">let</span> <span class="var">sessionidv_2</span>: <span class="type">bitstring</span> = <span class="name">sessionidv</span> <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ114 class="occ">{114}</a> <span class="keyword">in</span>(<span class="var">chVAPrep</span>, <span class="fun"></span>(<span class="var">dummyVote1</span>: <span class="type">dvote</span>,<span class="var">dummyVote2</span>: <span class="type">dvote</span>,<span class="var">zkp_1</span>: <span class="type">bitstring</span>,=<span class="var">sessionidv_2</span>));<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ115 class="occ">{115}</a> <span class="keyword">out</span>(<span class="name">ch</span>, <span class="fun"></span>(<span class="var">dummyVote1</span>,<span class="var">dummyVote2</span>,<span class="var">zkp_1</span>,<span class="var">sessionidv_2</span>));<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ111 class="occ">{111}</a> <span class="keyword">let</span> <span class="var">chVARec</span>: <span class="type">channel</span> = <span class="name">channelvareceipts</span> <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ116 class="occ">{116}</a> <span class="keyword">in</span>(<span class="var">chVARec</span>, <span class="fun"></span>(<span class="var">receipt_3</span>: <span class="type">bitstring</span>,<span class="var">newDummyVote3</span>: <span class="type">dvote</span>,<span class="var">zkp2</span>: <span class="type">bitstring</span>,<span class="var">unusedDvote</span>: <span class="type">dvote</span>,=<span class="var">sessionidv_2</span>));<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ117 class="occ">{117}</a> <span class="keyword">let</span> <span class="fun"></span>(<span class="var">c1</span>: <span class="type">commit</span>,<span class="var">c2</span>: <span class="type">commit</span>) = <span class="fun">openDummyVote</span>(<span class="var">unusedDvote</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ118 class="occ">{118}</a> <span class="keyword">new</span> <span class="name">BBinstance_2</span>: <span class="type">bitstring</span>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ119 class="occ">{119}</a> <span class="keyword">event</span> <span class="fun">BB</span>(<span class="var">receipt_3</span>,<span class="name">BBinstance_2</span>,<span class="var">sessionidv_2</span>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ113 class="occ">{113}</a> <span class="keyword">let</span> <span class="var">bbskey</span>: <span class="type">secretKey</span> = <span class="name">bbsecretkey</span> <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ120 class="occ">{120}</a> <span class="keyword">let</span> <span class="var">BBreceipt</span>: <span class="type">bitstring</span> = <span class="fun">sign</span>(<span class="fun"></span>(<span class="var">receipt_3</span>,<span class="name">BBinstance_2</span>,<span class="var">sessionidv_2</span>),<span class="var">bbskey</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ121 class="occ">{121}</a> <span class="keyword">out</span>(<span class="name">ch</span>, <span class="var">BBreceipt</span>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ112 class="occ">{112}</a> <span class="keyword">let</span> <span class="var">channelBBAndTest</span>: <span class="type">channel</span> = <span class="name">channelBBandTest</span> <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ122 class="occ">{122}</a> <span class="keyword">out</span>(<span class="var">channelBBAndTest</span>, <span class="fun"></span>(<span class="var">dummyVote1</span>,<span class="var">dummyVote2</span>,<span class="var">zkp_1</span>,<span class="var">receipt_3</span>,<span class="var">newDummyVote3</span>,<span class="var">zkp2</span>,<span class="fun">openCommit</span>(<span class="var">c1</span>),<span class="fun">openCommit</span>(<span class="var">c2</span>),<span class="var">sessionidv_2</span>,<span class="name">BBinstance_2</span>));<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ123 class="occ">{123}</a> <span class="keyword">out</span>(<span class="name">ch</span>, <span class="fun"></span>(<span class="var">dummyVote1</span>,<span class="var">dummyVote2</span>,<span class="var">zkp_1</span>,<span class="var">receipt_3</span>,<span class="var">newDummyVote3</span>,<span class="var">zkp2</span>,<span class="fun">openCommit</span>(<span class="var">c1</span>),<span class="fun">openCommit</span>(<span class="var">c2</span>),<span class="var">sessionidv_2</span>,<span class="name">BBinstance_2</span>))<br>
) | (<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ127 class="occ">{127}</a> <span class="keyword">let</span> <span class="var">channelTRGAndTest_1</span>: <span class="type">channel</span> = <span class="name">channeltrgandtest</span> <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ124 class="occ">{124}</a> <span class="keyword">let</span> <span class="var">sessionIdv</span>: <span class="type">bitstring</span> = <span class="name">sessionidv</span> <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ128 class="occ">{128}</a> <span class="keyword">in</span>(<span class="var">channelTRGAndTest_1</span>, <span class="fun"></span>(<span class="var">randomWithSignature_2</span>: <span class="type">bitstring</span>,=<span class="var">sessionIdv</span>));<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ126 class="occ">{126}</a> <span class="keyword">let</span> <span class="var">channelVoterandTest</span>: <span class="type">channel</span> = <span class="name">channelvoterandtest</span> <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ129 class="occ">{129}</a> <span class="keyword">in</span>(<span class="var">channelVoterandTest</span>, <span class="fun"></span>(<span class="var">candidateX_2</span>: <span class="type">bitstring</span>,<span class="var">receiptVoter</span>: <span class="type">bitstring</span>,=<span class="var">sessionIdv</span>));<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ125 class="occ">{125}</a> <span class="keyword">let</span> <span class="var">channelvaandtest</span>: <span class="type">channel</span> = <span class="name">channelVAandTest</span> <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ130 class="occ">{130}</a> <span class="keyword">in</span>(<span class="var">channelvaandtest</span>, <span class="var">paperballot</span>: <span class="type">bitstring</span>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ131 class="occ">{131}</a> <span class="keyword">let</span> <span class="fun"></span>(<span class="var">freshRandomNumber_3</span>: <span class="type">bitstring</span>,=<span class="var">sessionIdv</span>) = <span class="fun">checksign</span>(<span class="var">randomWithSignature_2</span>,<span class="var">trgpublickey</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ132 class="occ">{132}</a> <span class="keyword">let</span> <span class="fun"></span>(<span class="var">ca_1</span>: <span class="type">bitstring</span>,<span class="var">cb_1</span>: <span class="type">bitstring</span>,<span class="var">ra_1</span>: <span class="type">bitstring</span>,<span class="var">rb_1</span>: <span class="type">bitstring</span>,<span class="var">barcodeR'_1</span>: <span class="type">bitstring</span>,<span class="var">sessionIdv'</span>: <span class="type">bitstring</span>) = <span class="fun">checksign</span>(<span class="var">receiptVoter</span>,<span class="var">vmpublickey</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ133 class="occ">{133}</a> <span class="keyword">if</span> ((<span class="var">ca_1</span> <span class="fun">=</span> <span class="fun">candidate0</span>) <span class="fun">&amp;&amp;</span> ((<span class="var">cb_1</span> <span class="fun">=</span> <span class="fun">candidate1</span>) <span class="fun">&amp;&amp;</span> (((<span class="var">candidateX_2</span> <span class="fun">=</span> <span class="fun">candidate0</span>) <span class="fun">&amp;&amp;</span> (<span class="var">ra_1</span> <span class="fun">=</span> <span class="var">freshRandomNumber_3</span>)) <span class="fun">||</span> ((<span class="var">candidateX_2</span> <span class="fun">=</span> <span class="fun">candidate1</span>) <span class="fun">&amp;&amp;</span> (<span class="var">rb_1</span> <span class="fun">=</span> <span class="var">freshRandomNumber_3</span>))))) <span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ134 class="occ">{134}</a> <span class="keyword">event</span> <span class="fun">OKt</span>(<span class="var">freshRandomNumber_3</span>,<span class="var">candidateX_2</span>,<span class="var">sessionIdv</span>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ135 class="occ">{135}</a> <span class="keyword">event</span> <span class="fun">KOt</span>(<span class="var">freshRandomNumber_3</span>,<span class="var">candidateX_2</span>,<span class="var">sessionIdv</span>)<br>
)<br>
<br>
</body>
</html>
